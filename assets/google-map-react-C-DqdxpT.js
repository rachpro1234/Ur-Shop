import{e as y,r as re}from"./react-328yWDDP.js";import{o as p}from"./prop-types-EUydVlhc.js";import{n as z}from"./react-dom-AjuaLGBG.js";import{r as we}from"./eventemitter3-kxfTZM1Q.js";import{L as Le}from"./@googlemaps-xrxk7TKA.js";import{s as T}from"./@mapbox-P3eih9Ks.js";function _(){return(_=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n}).apply(this,arguments)}function B(n,r){var i,o;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,i=n,o=r,(Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,s){return e.__proto__=s,e})(i,o)}function V(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}var be={width:"100%",height:"100%",left:0,top:0,margin:0,padding:0,position:"absolute"},De=function(n){function r(){return n.apply(this,arguments)||this}B(r,n);var i=r.prototype;return i.shouldComponentUpdate=function(){return!1},i.render=function(){return y.createElement("div",{ref:this.props.registerChild,style:be})},r}(re.Component),ae=function(n){function r(o){var e;return(e=n.call(this)||this).gmapInstance=o,e}B(r,n);var i=r.prototype;return i.getChildren=function(){return this.gmapInstance.props.children},i.getMousePosition=function(){return this.gmapInstance.mouse_},i.getUpdateCounter=function(){return this.gmapInstance.updateCounter_},i.dispose=function(){this.gmapInstance=null,this.removeAllListeners()},r}(we),I=function(n,r){for(var i=_({},(function(s){if(s==null)throw new TypeError("Cannot destructure "+s)}(n),n)),o=0;o<r.length;o++){var e=r[o];e in i&&delete i[e]}return i},ze=Object.prototype.hasOwnProperty;function pe(n,r){return n===r?n!==0||r!==0||1/n==1/r:n!=n&&r!=r}function w(n,r){if(pe(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var i=Object.keys(n),o=Object.keys(r);if(i.length!==o.length)return!1;for(var e=0;e<i.length;e++)if(!ze.call(r,i[e])||!pe(n[i[e]],r[i[e]]))return!1;return!0}var Oe={width:"100%",height:"100%",left:0,top:0,margin:0,padding:0,position:"absolute"},ke={width:0,height:0,left:0,top:0,backgroundColor:"transparent",position:"absolute"},W=function(n){function r(o){var e;return(e=n.call(this,o)||this)._getState=function(){return{children:e.props.dispatcher.getChildren(),updateCounter:e.props.dispatcher.getUpdateCounter()}},e._onChangeHandler=function(){if(e.dimensionsCache_){var s=(e.state.children||[]).length,t=e._getState();e.setState(t,function(){return(t.children||[]).length!==s&&e._onMouseChangeHandler()})}},e._onChildClick=function(){e.props.onChildClick&&e.hoverChildProps_&&e.props.onChildClick(e.hoverKey_,e.hoverChildProps_)},e._onChildMouseDown=function(){e.props.onChildMouseDown&&e.hoverChildProps_&&e.props.onChildMouseDown(e.hoverKey_,e.hoverChildProps_)},e._onChildMouseEnter=function(s,t){e.dimensionsCache_&&(e.props.onChildMouseEnter&&e.props.onChildMouseEnter(s,t),e.hoverChildProps_=t,e.hoverKey_=s,e.setState({hoverKey:s}))},e._onChildMouseLeave=function(){if(e.dimensionsCache_){var s=e.hoverKey_;s!=null&&(e.props.onChildMouseLeave&&e.props.onChildMouseLeave(s,e.hoverChildProps_),e.hoverKey_=null,e.hoverChildProps_=null,e.setState({hoverKey:null}))}},e._onMouseAllow=function(s){s||e._onChildMouseLeave(),e.allowMouse_=s},e._onMouseChangeHandler=function(){e.allowMouse_&&e._onMouseChangeHandlerRaf()},e._onMouseChangeHandlerRaf=function(){if(e.dimensionsCache_){var s=e.props.dispatcher.getMousePosition();if(s){var t=[],u=e.props.getHoverDistance();if(y.Children.forEach(e.state.children,function(d,c){if(d&&(d.props.latLng!==void 0||d.props.lat!==void 0||d.props.lng!==void 0)){var C=d.key!=null?d.key:c,g=e.props.distanceToMouse(e.dimensionsCache_[C],s,d.props);g<u&&t.push({key:C,dist:g,props:d.props})}}),t.length){t.sort(function(d,c){return d.dist-c.dist});var a=t[0].key,h=t[0].props;e.hoverKey_!==a&&(e._onChildMouseLeave(),e._onChildMouseEnter(a,h))}else e._onChildMouseLeave()}else e._onChildMouseLeave()}},e._getDimensions=function(s){return e.dimensionsCache_[s]},e.dimensionsCache_={},e.hoverKey_=null,e.hoverChildProps_=null,e.allowMouse_=!0,e.state=_({},e._getState(),{hoverKey:null}),e}B(r,n);var i=r.prototype;return i.componentDidMount=function(){this.props.dispatcher.on("kON_CHANGE",this._onChangeHandler),this.props.dispatcher.on("kON_MOUSE_POSITION_CHANGE",this._onMouseChangeHandler),this.props.dispatcher.on("kON_CLICK",this._onChildClick),this.props.dispatcher.on("kON_MDOWN",this._onChildMouseDown)},i.shouldComponentUpdate=function(o,e){return this.props.experimental===!0?!w(this.props,o)||!w(I(this.state,["hoverKey"]),I(e,["hoverKey"])):!w(this.props,o)||!w(this.state,e)},i.componentWillUnmount=function(){this.props.dispatcher.removeListener("kON_CHANGE",this._onChangeHandler),this.props.dispatcher.removeListener("kON_MOUSE_POSITION_CHANGE",this._onMouseChangeHandler),this.props.dispatcher.removeListener("kON_CLICK",this._onChildClick),this.props.dispatcher.removeListener("kON_MDOWN",this._onChildMouseDown),this.dimensionsCache_=null},i.render=function(){var o=this,e=this.props.style||Oe;this.dimensionsCache_={};var s=y.Children.map(this.state.children,function(t,u){if(t){if(t.props.latLng===void 0&&t.props.lat===void 0&&t.props.lng===void 0)return y.cloneElement(t,{$geoService:o.props.geoService,$onMouseAllow:o._onMouseAllow,$prerender:o.props.prerender});var a=t.props.latLng!==void 0?t.props.latLng:{lat:t.props.lat,lng:t.props.lng},h=o.props.insideMapPanes?o.props.geoService.fromLatLngToDivPixel(a):o.props.geoService.fromLatLngToCenterPixel(a),d={left:h.x,top:h.y};if(t.props.seLatLng!==void 0||t.props.seLat!==void 0&&t.props.seLng!==void 0){var c=t.props.seLatLng!==void 0?t.props.seLatLng:{lat:t.props.seLat,lng:t.props.seLng},C=o.props.insideMapPanes?o.props.geoService.fromLatLngToDivPixel(c):o.props.geoService.fromLatLngToCenterPixel(c);d.width=C.x-h.x,d.height=C.y-h.y}var g=o.props.geoService.fromLatLngToContainerPixel(a),M=t.key!=null?t.key:u;return o.dimensionsCache_[M]=_({x:g.x,y:g.y},a),y.createElement("div",{key:M,style:_({},ke,d),className:t.props.$markerHolderClassName},y.cloneElement(t,{$hover:M===o.state.hoverKey,$getDimensions:o._getDimensions,$dimensionKey:M,$geoService:o.props.geoService,$onMouseAllow:o._onMouseAllow,$prerender:o.props.prerender}))}});return y.createElement("div",{style:e},s)},r}(re.Component);W.propTypes={geoService:p.any,style:p.any,distanceToMouse:p.func,dispatcher:p.any,onChildClick:p.func,onChildMouseDown:p.func,onChildMouseLeave:p.func,onChildMouseEnter:p.func,getHoverDistance:p.func,insideMapPanes:p.bool,prerender:p.bool},W.defaultProps={insideMapPanes:!1,prerender:!1};var Se={width:"50%",height:"50%",left:"50%",top:"50%",margin:0,padding:0,position:"absolute"};function Te(n){return y.createElement("div",{style:Se},y.createElement(W,_({},n,{prerender:!0})))}var $,P,Q,Ee=["key"],Pe=new Promise(function(n){Q=n}),le=function(n,r){if(!n)return Pe;if(P)return P;n.libraries||(n.libraries=[]);var i=[].concat(n.libraries);if(r&&(i.length!==0&&i.includes("visualization")||i.push("visualization"),console.warn("heatmapLibrary will be deprecated in the future. Please use { libraries: ['visualization'] } in bootstrapURLKeys property instead")),typeof window>"u")throw new Error("google map cannot be loaded outside browser env");var o=n.key,e=function(s,t){if(s==null)return{};var u,a,h={},d=Object.keys(s);for(a=0;a<d.length;a++)t.indexOf(u=d[a])>=0||(h[u]=s[u]);return h}(n,Ee);return $||($=new Le(_({apiKey:o||""},e,{libraries:i}))),P=$.load().then(function(){return Q(window.google.maps),window.google.maps}),Q(P),P};function ye(n,r,i){var o=i-r;return n===i?n:((n-r)%o+o)%o+r}var O=function(){function n(r,i){if(isNaN(r)||isNaN(i))throw new Error("Invalid LatLng object: ("+r+", "+i+")");this.lat=+r,this.lng=+i}return n.prototype.wrap=function(){return new n(this.lat,ye(this.lng,-180,180))},n}();O.convert=function(n){return n instanceof O?n:Array.isArray(n)?new O(n[0],n[1]):"lng"in n&&"lat"in n?new O(n.lat,n.lng):n};var xe=function(){function n(e,s,t){this.tileSize=e||512,this._minZoom=s||0,this._maxZoom=t||52,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this.zoom=0,this.center=new O(0,0),this.angle=0}var r,i,o=n.prototype;return o.zoomScale=function(e){return Math.pow(2,e)},o.scaleZoom=function(e){return Math.log(e)/Math.LN2},o.project=function(e,s){return new T(this.lngX(e.lng,s),this.latY(e.lat,s))},o.unproject=function(e,s){return new O(this.yLat(e.y,s),this.xLng(e.x,s))},o.lngX=function(e,s){return(180+e)*(s||this.worldSize)/360},o.latY=function(e,s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))*(s||this.worldSize)/360},o.xLng=function(e,s){return 360*e/(s||this.worldSize)-180},o.yLat=function(e,s){return 360/Math.PI*Math.atan(Math.exp((180-360*e/(s||this.worldSize))*Math.PI/180))-90},o.locationPoint=function(e){var s=this.project(e);return this.centerPoint._sub(this.point._sub(s)._rotate(this.angle))},o.pointLocation=function(e){var s=this.centerPoint._sub(e)._rotate(-this.angle);return this.unproject(this.point.sub(s))},r=n,(i=[{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom=e,this.zoom=Math.max(this.zoom,e)}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom=e,this.zoom=Math.min(this.zoom,e)}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerPoint",get:function(){return new T(0,0)}},{key:"size",get:function(){return new T(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){this.angle=-ye(e,-180,180)*Math.PI/180}},{key:"zoom",get:function(){return this._zoom},set:function(e){var s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}},{key:"x",get:function(){return this.lngX(this.center.lng)}},{key:"y",get:function(){return this.latY(this.center.lat)}},{key:"point",get:function(){return new T(this.x,this.y)}}])&&function(e,s){for(var t=0;t<s.length;t++){var u=s[t];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(e,typeof(a=function(h,d){if(typeof h!="object"||h===null)return h;var c=h[Symbol.toPrimitive];if(c!==void 0){var C=c.call(h,"string");if(typeof C!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(h)}(u.key))=="symbol"?a:String(a),u)}var a}(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),n}(),Ae=function(){function n(i){this.hasSize_=!1,this.hasView_=!1,this.transform_=new xe(i||512)}var r=n.prototype;return r.setView=function(i,o,e){this.transform_.center=O.convert(i),this.transform_.zoom=+o,this.transform_.bearing=+e,this.hasView_=!0},r.setViewSize=function(i,o){this.transform_.width=i,this.transform_.height=o,this.hasSize_=!0},r.setMapCanvasProjection=function(i,o){this.maps_=i,this.mapCanvasProjection_=o},r.canProject=function(){return this.hasSize_&&this.hasView_},r.hasSize=function(){return this.hasSize_},r.fromLatLngToCenterPixel=function(i){return this.transform_.locationPoint(O.convert(i))},r.fromLatLngToDivPixel=function(i){if(this.mapCanvasProjection_){var o=new this.maps_.LatLng(i.lat,i.lng);return this.mapCanvasProjection_.fromLatLngToDivPixel(o)}return this.fromLatLngToCenterPixel(i)},r.fromLatLngToContainerPixel=function(i){if(this.mapCanvasProjection_){var o=new this.maps_.LatLng(i.lat,i.lng);return this.mapCanvasProjection_.fromLatLngToContainerPixel(o)}var e=this.fromLatLngToCenterPixel(i);return e.x-=this.transform_.worldSize*Math.round(e.x/this.transform_.worldSize),e.x+=this.transform_.width/2,e.y+=this.transform_.height/2,e},r.fromContainerPixelToLatLng=function(i){if(this.mapCanvasProjection_){var o=this.mapCanvasProjection_.fromContainerPixelToLatLng(i);return{lat:o.lat(),lng:o.lng()}}var e=_({},i);e.x-=this.transform_.width/2,e.y-=this.transform_.height/2;var s=this.transform_.pointLocation(T.convert(e));return s.lng-=360*Math.round(s.lng/360),s},r.getWidth=function(){return this.transform_.width},r.getHeight=function(){return this.transform_.height},r.getZoom=function(){return this.transform_.zoom},r.getCenter=function(){return this.transform_.pointLocation({x:0,y:0})},r.getBounds=function(i,o){var e=i&&i[0]||0,s=i&&i[1]||0,t=i&&i[2]||0,u=i&&i[3]||0;if(this.getWidth()-s-u>0&&this.getHeight()-e-t>0){var a=this.transform_.pointLocation(T.convert({x:u-this.getWidth()/2,y:e-this.getHeight()/2})),h=this.transform_.pointLocation(T.convert({x:this.getWidth()/2-s,y:this.getHeight()/2-t})),d=[a.lat,a.lng,h.lat,h.lng,h.lat,a.lng,a.lat,h.lng];return o&&(d=d.map(function(c){return Math.round(c*o)/o})),d}return[0,0,0,0]},n}();function ue(n){if(window.requestAnimationFrame)return window.requestAnimationFrame(n);var r=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;return r?r(n):window.setTimeout(n,1e3/60)}var Ne=Math.log2?Math.log2:function(n){return Math.log(n)/Math.LN2};function he(n,r){return Object.keys(n).reduce(function(i,o){return r(n[o])&&(i[o]=n[o]),i},{})}var S=function(n){if(n!==null&&typeof n=="object"){if(Object.keys(n).length===0)return!0}else if(n==null||n==="")return!0;return!1},Ie=Object.prototype.toString;function H(n){return typeof n=="number"||function(r){return!!r&&typeof r=="object"}(n)&&Ie.call(n)==="[object Number]"}var U=null;function ce(){if(U)return U;if(typeof navigator<"u"){var n=navigator.userAgent.indexOf("MSIE")>-1,r=navigator.userAgent.indexOf("Firefox")>-1,i=navigator.userAgent.toLowerCase().indexOf("op")>-1,o=navigator.userAgent.indexOf("Chrome")>-1,e=navigator.userAgent.indexOf("Safari")>-1;return o&&e&&(e=!1),o&&i&&(o=!1),U={isExplorer:n,isFirefox:r,isOpera:i,isChrome:o,isSafari:e}}return U={isChrome:!0,isExplorer:!1,isFirefox:!1,isOpera:!1,isSafari:!1}}var de=function(n){return Function.prototype.toString.call(n)};function N(n){if(!n||typeof n!="object")return!1;var r=typeof n.constructor=="function"?Object.getPrototypeOf(n):Object.prototype;if(r===null)return!0;var i=r.constructor;return typeof i=="function"&&i instanceof i&&de(i)===de(Object)}function x(n,r,i,o){n.addEventListener(r,i,function(){var e=!1;try{var s=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",s,s),window.removeEventListener("test",s,s)}catch{e=!1}return e}()?{capture:o,passive:!0}:o)}var L,ee=!(typeof window>"u"||!window.document||!window.document.createElement);L=ee?window:typeof self<"u"?self:void 0;var me,te=typeof document<"u"&&document.attachEvent,fe=!1;if(ee&&!te){var Ze=function(){var n=L.requestAnimationFrame||L.mozRequestAnimationFrame||L.webkitRequestAnimationFrame||function(r){return L.setTimeout(r,20)};return function(r){return n(r)}}(),je=(me=L.cancelAnimationFrame||L.mozCancelAnimationFrame||L.webkitCancelAnimationFrame||L.clearTimeout,function(n){return me(n)}),ne=function(n){var r=n.__resizeTriggers__,i=r.firstElementChild,o=r.lastElementChild,e=i.firstElementChild;o.scrollLeft=o.scrollWidth,o.scrollTop=o.scrollHeight,e.style.width=i.offsetWidth+1+"px",e.style.height=i.offsetHeight+1+"px",i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight},_e=function(n){var r=this;ne(this),this.__resizeRAF__&&je(this.__resizeRAF__),this.__resizeRAF__=Ze(function(){(function(i){return i.offsetWidth!=i.__resizeLast__.width||i.offsetHeight!=i.__resizeLast__.height})(r)&&(r.__resizeLast__.width=r.offsetWidth,r.__resizeLast__.height=r.offsetHeight,r.__resizeListeners__.forEach(function(i){i.call(r,n)}))})},q=!1,X="",oe="animationstart",Y="Webkit Moz O ms".split(" "),He="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" ");if(ee){var ge=document.createElement("fakeelement");if(ge.style.animationName!==void 0&&(q=!0),q===!1){for(var A=0;A<Y.length;A++)if(ge.style[Y[A]+"AnimationName"]!==void 0){X="-"+Y[A].toLowerCase()+"-",oe=He[A],q=!0;break}}}var ie="resizeanim",Ue="@"+X+"keyframes "+ie+" { from { opacity: 0; } to { opacity: 0; } } ",Re=X+"animation: 1ms "+ie+"; "}var K=z.createPortal!==void 0,ve=K?z.createPortal:z.unstable_renderSubtreeIntoContainer,R=function(n){return N(n)?n:{lat:n[0],lng:n[1]}},Ce=function(n,r){return r<n?n:r},J=function(n){function r(o){var e;if((e=n.call(this,o)||this)._getMinZoom=function(){if(e.geoService_.getWidth()>0||e.geoService_.getHeight()>0){var t=Math.ceil(e.geoService_.getWidth()/256)+2,u=Math.ceil(e.geoService_.getHeight()/256)+2,a=Math.max(t,u);return Math.ceil(Ne(a))}return 3},e._computeMinZoom=function(t){return S(t)?e._getMinZoom():t},e._mapDomResizeCallback=function(){if(e.resetSizeOnIdle_=!0,e.maps_){var t=e.props.center||e.props.defaultCenter,u=e.map_.getCenter();e.maps_.event.trigger(e.map_,"resize"),e.map_.setCenter(e.props.resetBoundsOnResize?t:u)}},e._setLayers=function(t){t.forEach(function(u){e.layers_[u]=new e.maps_[u],e.layers_[u].setMap(e.map_)})},e._renderPortal=function(){return y.createElement(W,{experimental:e.props.experimental,onChildClick:e._onChildClick,onChildMouseDown:e._onChildMouseDown,onChildMouseEnter:e._onChildMouseEnter,onChildMouseLeave:e._onChildMouseLeave,geoService:e.geoService_,insideMapPanes:!0,distanceToMouse:e.props.distanceToMouse,getHoverDistance:e._getHoverDistance,dispatcher:e.markersDispatcher_})},e._initMap=function(){if(!e.initialized_){e.initialized_=!0;var t=R(e.props.center||e.props.defaultCenter);e.geoService_.setView(t,e.props.zoom||e.props.defaultZoom,0),e._onBoundsChanged();var u=_({},e.props.apiKey&&{key:e.props.apiKey},e.props.bootstrapURLKeys);e.props.googleMapLoader(u,e.props.heatmapLibrary).then(function(a){if(e.mounted_){var h,d,c=e.geoService_.getCenter(),C={zoom:e.props.zoom||e.props.defaultZoom,center:new a.LatLng(c.lat,c.lng)};e.props.heatmap.positions&&(Object.assign(V(e),{heatmap:(h=a,d=e.props.heatmap,new h.visualization.HeatmapLayer({data:d.positions.reduce(function(f,k){var v=k.weight,D=v===void 0?1:v;return f.push({location:new h.LatLng(k.lat,k.lng),weight:D}),f},[])}))}),function(f,k){var v=k.options,D=v===void 0?{}:v;Object.keys(D).map(function(E){return f.set(E,D[E])})}(e.heatmap,e.props.heatmap));var g=he(a,N),M=typeof e.props.options=="function"?e.props.options(g):e.props.options,Z=!S(e.props.draggable)&&{draggable:e.props.draggable},j=e._computeMinZoom(M.minZoom);e.minZoom_=j;var b=_({},{overviewMapControl:!1,streetViewControl:!1,rotateControl:!0,mapTypeControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],minZoom:3},{minZoom:j},M,C);e.defaultDraggableOption_=S(b.draggable)?e.defaultDraggableOption_:b.draggable;var F=_({},b,Z);F.minZoom=Ce(F.minZoom,j);var m=new a.Map(z.findDOMNode(e.googleMapDom_),F);e.map_=m,e.maps_=a,e._setLayers(e.props.layerTypes);var se=a.version.match(/^3\.(\d+)\./),Me=se&&Number(se[1]),l=V(e),G=Object.assign(new a.OverlayView,{onAdd:function(){var f=typeof screen<"u"?screen.width+"px":"2000px",k=typeof screen<"u"?screen.height+"px":"2000px",v=document.createElement("div");if(v.style.backgroundColor="transparent",v.style.position="absolute",v.style.left="0px",v.style.top="0px",v.style.width=f,v.style.height=k,l.props.overlayViewDivStyle){var D=l.props.overlayViewDivStyle;typeof D=="object"&&Object.keys(D).forEach(function(E){v.style[E]=D[E]})}this.getPanes().overlayMouseTarget.appendChild(v),l.geoService_.setMapCanvasProjection(a,G.getProjection()),K?l.setState({overlay:v}):ve(l,l._renderPortal(),v,function(){return l.setState({overlay:v})})},onRemove:function(){var f=l.state.overlay;f&&!K&&z.unmountComponentAtNode(f),l.setState({overlay:null})},draw:function(){if(l.updateCounter_++,l._onBoundsChanged(m,a,!l.props.debounced),l.googleApiLoadedCalled_||(l._onGoogleApiLoaded({map:m,maps:a,ref:l.googleMapDom_}),l.googleApiLoadedCalled_=!0),l.mouse_){var f=l.geoService_.fromContainerPixelToLatLng(l.mouse_);l.mouse_.lat=f.lat,l.mouse_.lng=f.lng}l._onChildMouseMove(),l.markersDispatcher_&&(l.markersDispatcher_.emit("kON_CHANGE"),l.fireMouseEventOnIdle_&&l.markersDispatcher_.emit("kON_MOUSE_POSITION_CHANGE"))}});e.overlay_=G,G.setMap(m),e.props.heatmap.positions&&e.heatmap.setMap(m),e.props.onTilesLoaded&&a.event.addListener(m,"tilesloaded",function(){l._onTilesLoaded()}),a.event.addListener(m,"zoom_changed",function(){l.geoService_.getZoom()!==m.getZoom()&&(l.zoomAnimationInProgress_||(l.zoomAnimationInProgress_=!0,l._onZoomAnimationStart(m.zoom)),Me<32)&&(new Date().getTime()-e.zoomControlClickTime_<300?ue(function(){return ue(function(){l.updateCounter_++,l._onBoundsChanged(m,a)})}):(l.updateCounter_++,l._onBoundsChanged(m,a)))}),a.event.addListener(m,"idle",function(){if(e.resetSizeOnIdle_){e._setViewSize();var f=e._computeMinZoom(M.minZoom);f!==e.minZoom_&&(e.minZoom_=f,m.setOptions({minZoom:f})),e.resetSizeOnIdle_=!1}l.zoomAnimationInProgress_&&(l.zoomAnimationInProgress_=!1,l._onZoomAnimationEnd(m.zoom)),l.updateCounter_++,l._onBoundsChanged(m,a),l.dragTime_=0,l.markersDispatcher_&&l.markersDispatcher_.emit("kON_CHANGE")}),a.event.addListener(m,"mouseover",function(){l.mouseInMap_=!0}),a.event.addListener(m,"click",function(){l.mouseInMap_=!0}),a.event.addListener(m,"mouseout",function(){l.mouseInMap_=!1,l.mouse_=null,l.markersDispatcher_.emit("kON_MOUSE_POSITION_CHANGE")}),a.event.addListener(m,"drag",function(){l.dragTime_=new Date().getTime(),l._onDrag(m)}),a.event.addListener(m,"dragend",function(){var f=a.event.addListener(m,"idle",function(){a.event.removeListener(f),l._onDragEnd(m)})}),a.event.addListener(m,"maptypeid_changed",function(){l._onMapTypeIdChange(m.getMapTypeId())})}}).catch(function(a){throw e._onGoogleApiLoaded({map:null,maps:null,ref:e.googleMapDom_}),console.error(a),a})}},e._onGoogleApiLoaded=function(){var t;e.props.onGoogleApiLoaded&&(t=e.props).onGoogleApiLoaded.apply(t,arguments)},e._getHoverDistance=function(){return e.props.hoverDistance},e._onDrag=function(){var t;return e.props.onDrag&&(t=e.props).onDrag.apply(t,arguments)},e._onDragEnd=function(){var t;return e.props.onDragEnd&&(t=e.props).onDragEnd.apply(t,arguments)},e._onMapTypeIdChange=function(){var t;return e.props.onMapTypeIdChange&&(t=e.props).onMapTypeIdChange.apply(t,arguments)},e._onZoomAnimationStart=function(){var t;return e.props.onZoomAnimationStart&&(t=e.props).onZoomAnimationStart.apply(t,arguments)},e._onZoomAnimationEnd=function(){var t;return e.props.onZoomAnimationEnd&&(t=e.props).onZoomAnimationEnd.apply(t,arguments)},e._onTilesLoaded=function(){return e.props.onTilesLoaded&&e.props.onTilesLoaded()},e._onChildClick=function(){var t;if(e.props.onChildClick)return(t=e.props).onChildClick.apply(t,arguments)},e._onChildMouseDown=function(t,u){e.childMouseDownArgs_=[t,u],e.props.onChildMouseDown&&e.props.onChildMouseDown(t,u,_({},e.mouse_))},e._onChildMouseUp=function(){var t;e.childMouseDownArgs_&&(e.props.onChildMouseUp&&(t=e.props).onChildMouseUp.apply(t,e.childMouseDownArgs_.concat([_({},e.mouse_)])),e.childMouseDownArgs_=null,e.childMouseUpTime_=new Date().getTime())},e._onChildMouseMove=function(){var t;e.childMouseDownArgs_&&e.props.onChildMouseMove&&(t=e.props).onChildMouseMove.apply(t,e.childMouseDownArgs_.concat([_({},e.mouse_)]))},e._onChildMouseEnter=function(){var t;if(e.props.onChildMouseEnter)return(t=e.props).onChildMouseEnter.apply(t,arguments)},e._onChildMouseLeave=function(){var t;if(e.props.onChildMouseLeave)return(t=e.props).onChildMouseLeave.apply(t,arguments)},e._setViewSize=function(){if(e.mounted_){if(document.fullscreen||document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement)e.geoService_.setViewSize(window.innerWidth,window.innerHeight);else{var t=z.findDOMNode(e.googleMapDom_);e.geoService_.setViewSize(t.clientWidth,t.clientHeight)}e._onBoundsChanged()}},e._onWindowResize=function(){e.resetSizeOnIdle_=!0},e._onMapMouseMove=function(t){if(e.mouseInMap_){var u=new Date().getTime();u-e.mouseMoveTime_>50&&(e.boundingRect_=t.currentTarget.getBoundingClientRect()),e.mouseMoveTime_=u;var a=t.clientX-e.boundingRect_.left,h=t.clientY-e.boundingRect_.top;e.mouse_||(e.mouse_={x:0,y:0,lat:0,lng:0}),e.mouse_.x=a,e.mouse_.y=h;var d=e.geoService_.fromContainerPixelToLatLng(e.mouse_);e.mouse_.lat=d.lat,e.mouse_.lng=d.lng,e._onChildMouseMove(),u-e.dragTime_<100?e.fireMouseEventOnIdle_=!0:(e.markersDispatcher_.emit("kON_MOUSE_POSITION_CHANGE"),e.fireMouseEventOnIdle_=!1)}},e._onClick=function(){var t;return e.props.onClick&&!e.childMouseDownArgs_&&new Date().getTime()-e.childMouseUpTime_>300&&e.dragTime_===0&&(t=e.props).onClick.apply(t,arguments)},e._onMapClick=function(t){e.markersDispatcher_&&(e._onMapMouseMove(t),new Date().getTime()-e.dragTime_>100&&(e.mouse_&&e._onClick(_({},e.mouse_,{event:t})),e.markersDispatcher_.emit("kON_CLICK",t)))},e._onMapMouseDownNative=function(t){e.mouseInMap_&&e._onMapMouseDown(t)},e._onMapMouseDown=function(t){e.markersDispatcher_&&new Date().getTime()-e.dragTime_>100&&(e._onMapMouseMove(t),e.markersDispatcher_.emit("kON_MDOWN",t))},e._onMapMouseDownCapture=function(){ce().isChrome&&(e.zoomControlClickTime_=new Date().getTime())},e._onKeyDownCapture=function(){ce().isChrome&&(e.zoomControlClickTime_=new Date().getTime())},e._isCenterDefined=function(t){return t&&(N(t)&&H(t.lat)&&H(t.lng)||t.length===2&&H(t[0])&&H(t[1]))},e._onBoundsChanged=function(t,u,a){if(t){var h=t.getCenter();e.geoService_.setView([h.lat(),h.lng()],t.getZoom(),0)}if((e.props.onChange||e.props.onBoundsChange)&&e.geoService_.canProject()){var d=e.geoService_.getZoom(),c=e.geoService_.getBounds(),C=e.geoService_.getCenter();if(!function(M,Z,j){if(M&&Z){for(var b=0;b!==M.length;++b)if(Math.abs(M[b]-Z[b])>1e-5)return!1;return!0}return!1}(c,e.prevBounds_)&&a!==!1){var g=e.geoService_.getBounds(e.props.margin);e.props.onBoundsChange&&e.props.onBoundsChange(e.centerIsObject_?_({},C):[C.lat,C.lng],d,c,g),e.props.onChange&&e.props.onChange({center:_({},C),zoom:d,bounds:{nw:{lat:c[0],lng:c[1]},se:{lat:c[2],lng:c[3]},sw:{lat:c[4],lng:c[5]},ne:{lat:c[6],lng:c[7]}},marginBounds:{nw:{lat:g[0],lng:g[1]},se:{lat:g[2],lng:g[3]},sw:{lat:g[4],lng:g[5]},ne:{lat:g[6],lng:g[7]}},size:e.geoService_.hasSize()?{width:e.geoService_.getWidth(),height:e.geoService_.getHeight()}:{width:0,height:0}}),e.prevBounds_=c}}},e._registerChild=function(t){e.googleMapDom_=t},e.mounted_=!1,e.initialized_=!1,e.googleApiLoadedCalled_=!1,e.map_=null,e.maps_=null,e.prevBounds_=null,e.heatmap=null,e.layers_={},e.mouse_=null,e.mouseMoveTime_=0,e.boundingRect_=null,e.mouseInMap_=!0,e.dragTime_=0,e.fireMouseEventOnIdle_=!1,e.updateCounter_=0,e.markersDispatcher_=new ae(V(e)),e.geoService_=new Ae(256),e.centerIsObject_=N(e.props.center),e.minZoom_=3,e.defaultDraggableOption_=!0,e.zoomControlClickTime_=0,e.childMouseDownArgs_=null,e.childMouseUpTime_=0,e.googleMapDom_=null,e._isCenterDefined(e.props.center||e.props.defaultCenter)){var s=R(e.props.center||e.props.defaultCenter);e.geoService_.setView(s,e.props.zoom||e.props.defaultZoom,0)}return e.zoomAnimationInProgress_=!1,e.state={overlay:null},e}B(r,n);var i=r.prototype;return i.componentDidMount=function(){var o=this;this.mounted_=!0,this.markersDispatcher_=new ae(this),x(window,"resize",this._onWindowResize,!1),x(window,"keydown",this._onKeyDownCapture,!0);var e=z.findDOMNode(this.googleMapDom_);e&&x(e,"mousedown",this._onMapMouseDownNative,!0),x(window,"mouseup",this._onChildMouseUp,!1);var s=_({},this.props.apiKey&&{key:this.props.apiKey},this.props.bootstrapURLKeys);this.props.googleMapLoader(s,this.props.heatmapLibrary),setTimeout(function(){o._setViewSize(),o._isCenterDefined(o.props.center||o.props.defaultCenter)&&o._initMap()},0,this),this.props.resetBoundsOnResize&&function(t,u){if(t.parentNode===void 0){var a=document.createElement("div");t.parentNode=a}t=t.parentNode,te?t.attachEvent("onresize",u):(t.__resizeTriggers__||(getComputedStyle(t).position=="static"&&(t.style.position="relative"),function(){if(!fe){var h=(Ue||"")+".resize-triggers { "+(Re||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',d=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=h:c.appendChild(document.createTextNode(h)),d.appendChild(c),fe=!0}}(),t.__resizeLast__={},t.__resizeListeners__=[],(t.__resizeTriggers__=document.createElement("div")).className="resize-triggers",t.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',t.appendChild(t.__resizeTriggers__),ne(t),x(t,"scroll",_e,!0),oe&&t.__resizeTriggers__.addEventListener(oe,function(h){h.animationName==ie&&ne(t)})),t.__resizeListeners__.push(u))}(e,this._mapDomResizeCallback)},i.shouldComponentUpdate=function(o,e){return!w(I(this.props,["draggable"]),I(o,["draggable"]))||!w(this.state,e)},i.componentDidUpdate=function(o){var e=this;if(!this._isCenterDefined(o.center)&&this._isCenterDefined(this.props.center)&&setTimeout(function(){return e._initMap()},0),this.map_){var s=this.geoService_.getCenter();if(this._isCenterDefined(this.props.center)){var t=R(this.props.center),u=this._isCenterDefined(o.center)?R(o.center):null;(!u||Math.abs(t.lat-u.lat)+Math.abs(t.lng-u.lng)>1e-5)&&Math.abs(t.lat-s.lat)+Math.abs(t.lng-s.lng)>1e-5&&this.map_.panTo({lat:t.lat,lng:t.lng})}if(S(this.props.zoom)||Math.abs(this.props.zoom-o.zoom)>0&&this.map_.setZoom(this.props.zoom),!S(o.draggable)&&S(this.props.draggable)?this.map_.setOptions({draggable:this.defaultDraggableOption_}):w(o.draggable,this.props.draggable)||this.map_.setOptions({draggable:this.props.draggable}),!S(this.props.options)&&!w(o.options,this.props.options)){var a=he(this.maps_,N),h=typeof this.props.options=="function"?this.props.options(a):this.props.options;if("minZoom"in(h=I(h,["zoom","center","draggable"]))){var d=this._computeMinZoom(h.minZoom);h.minZoom=Ce(h.minZoom,d)}this.map_.setOptions(h)}w(this.props.layerTypes,o.layerTypes)||(Object.keys(this.layers_).forEach(function(c){e.layers_[c].setMap(null),delete e.layers_[c]}),this._setLayers(this.props.layerTypes)),this.heatmap&&!w(this.props.heatmap.positions,o.heatmap.positions)&&this.heatmap.setData(this.props.heatmap.positions.map(function(c){return{location:new e.maps_.LatLng(c.lat,c.lng),weight:c.weight}})),this.heatmap&&!w(this.props.heatmap.options,o.heatmap.options)&&Object.keys(this.props.heatmap.options).forEach(function(c){e.heatmap.set(c,e.props.heatmap.options[c])})}this.markersDispatcher_.emit("kON_CHANGE"),w(this.props.hoverDistance,o.hoverDistance)||this.markersDispatcher_.emit("kON_MOUSE_POSITION_CHANGE")},i.componentWillUnmount=function(){this.mounted_=!1;var o,e,s=z.findDOMNode(this.googleMapDom_);s&&s.removeEventListener("mousedown",this._onMapMouseDownNative,!0),window.removeEventListener("resize",this._onWindowResize),window.removeEventListener("keydown",this._onKeyDownCapture),window.removeEventListener("mouseup",this._onChildMouseUp,!1),this.props.resetBoundsOnResize&&(e=this._mapDomResizeCallback,o=(o=s).parentNode,te?o.detachEvent("onresize",e):(o.__resizeListeners__.splice(o.__resizeListeners__.indexOf(e),1),o.__resizeListeners__.length||(o.removeEventListener("scroll",_e),o.__resizeTriggers__=!o.removeChild(o.__resizeTriggers__)))),this.overlay_&&this.overlay_.setMap(null),this.maps_&&this.map_&&this.props.shouldUnregisterMapOnUnmount&&(this.map_.setOptions({scrollwheel:!1}),this.maps_.event.clearInstanceListeners(this.map_)),this.props.shouldUnregisterMapOnUnmount&&(this.map_=null,this.maps_=null),this.markersDispatcher_.dispose(),this.resetSizeOnIdle_=!1,this.props.shouldUnregisterMapOnUnmount&&(delete this.map_,delete this.markersDispatcher_)},i.render=function(){var o=this.state.overlay,e=o?null:y.createElement(Te,{experimental:this.props.experimental,onChildClick:this._onChildClick,onChildMouseDown:this._onChildMouseDown,onChildMouseEnter:this._onChildMouseEnter,onChildMouseLeave:this._onChildMouseLeave,geoService:this.geoService_,insideMapPanes:!1,distanceToMouse:this.props.distanceToMouse,getHoverDistance:this._getHoverDistance,dispatcher:this.markersDispatcher_});return y.createElement("div",{style:this.props.style,onMouseMove:this._onMapMouseMove,onMouseDownCapture:this._onMapMouseDownCapture,onClick:this._onMapClick},y.createElement(De,{registerChild:this._registerChild}),K&&o&&ve(this._renderPortal(),o),e)},r}(re.Component);J.propTypes={apiKey:p.string,bootstrapURLKeys:p.any,defaultCenter:p.oneOfType([p.array,p.shape({lat:p.number,lng:p.number})]),center:p.oneOfType([p.array,p.shape({lat:p.number,lng:p.number})]),defaultZoom:p.number,zoom:p.number,onBoundsChange:p.func,onChange:p.func,onClick:p.func,onChildClick:p.func,onChildMouseDown:p.func,onChildMouseUp:p.func,onChildMouseMove:p.func,onChildMouseEnter:p.func,onChildMouseLeave:p.func,onZoomAnimationStart:p.func,onZoomAnimationEnd:p.func,onDrag:p.func,onDragEnd:p.func,onMapTypeIdChange:p.func,onTilesLoaded:p.func,options:p.any,distanceToMouse:p.func,hoverDistance:p.number,debounced:p.bool,margin:p.array,googleMapLoader:p.any,onGoogleApiLoaded:p.func,yesIWantToUseGoogleMapApiInternals:p.bool,draggable:p.bool,style:p.any,resetBoundsOnResize:p.bool,layerTypes:p.arrayOf(p.string),shouldUnregisterMapOnUnmount:p.bool},J.defaultProps={distanceToMouse:function(n,r){return Math.sqrt((n.x-r.x)*(n.x-r.x)+(n.y-r.y)*(n.y-r.y))},hoverDistance:30,debounced:!0,options:function(){return{overviewMapControl:!1,streetViewControl:!1,rotateControl:!0,mapTypeControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],minZoom:3}},googleMapLoader:le,yesIWantToUseGoogleMapApiInternals:!1,style:{width:"100%",height:"100%",margin:0,padding:0,position:"relative"},layerTypes:[],heatmap:{},heatmapLibrary:!1,shouldUnregisterMapOnUnmount:!0},J.googleMapLoader=le;export{J as c};
